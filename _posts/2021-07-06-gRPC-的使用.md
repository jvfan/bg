---

layout:     post
title:      gRPC 的使用
subtitle:   介绍一种语言中立的远程过程调用工具 gRPC
date:       2021-07-06
author:     Jerry Chen
header-img: img/post-bg-debug.png
catalog: true
tags:
    - gRPC
---

### 介绍 gRPC

gRPC 是由 google 开发的一款语言中立、平台中立、开源的远程过程调用（RPC）系统。

* 定义一个服务，指定其能够被远程调用的方法（包含参数和返回类型）；
* 在服务端实现这个服务接口，运行一个 gRPC 服务器来处理客户端调用；
* 在客户端调用服务端的方法，就像调用本地函数一样。

[官网](https://www.grpc.io/) | [下载](https://github.com/grpc/grpc/releases) | [中文文档](http://doc.oschina.net/grpc)

### 安装 gRPC

1. 安装依赖项

   ```shell
   sudo apt-get install build-essential autoconf libtool pkg-config openssl libssl-dev libc++-dev
   ```

2. 从 [github](https://github.com/grpc/grpc/releases) 下载，并下载第三方模块

   ```shell
   git clone -b RELEASE_TAG_HERE https://github.com/grpc/grpc.git
   cd grpc
   git submodule update --init
   ```

3. 安装 absl 第三方模块依赖

   > Abseil 是一个开源的C++库代码集合，旨在增强C++标准库；

   ```shell
   cd third_party/abseil-cpp
   mkdir build
   cd build
   cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_POSITION_INDEPENDENT_CODE=TRUE ..
   make
   sudo make install
   ```

4. 安装 c-ares 第三方模块依赖

   ```shell
   cd third_party/cares/cares
   mkdir build
   cd build
   cmake -DCMAKE_BUILD_TYPE=Release ..
   make
   sudo make install
   ```

5. 安装 protobuf 第三方模块依赖

   > 如果已经安装过就不需要再安装了；

   ```shell
   cd third_party/protobuf/cmake
   mkdir build
   cd build
   cmake -Dprotobuf_BUILD_TESTS=OFF -DCMAKE_BUILD_TYPE=Release ..
   make
   sudo make install
   ```

6. 安装 zlib 第三方模块依赖

   ```shell
   cd third_party/zlib
   mkdir build
   cd build
   cmake -DCMAKE_BUILD_TYPE=Release ..
   make
   sudo make install
   ```

7. 安装 gRPC

   > 安装完成后，会在 /usr/local/bin 目录生成 grpc_cpp_plugin 执行文件；

   ```shell
   cd grpc
   mkdir -p cmake/build
   cd cmake/build
   cmake ../.. -DgRPC_INSTALL=ON                \
               -DCMAKE_BUILD_TYPE=Release       \
               -DgRPC_ABSL_PROVIDER=package     \
               -DgRPC_CARES_PROVIDER=package    \
               -DgRPC_PROTOBUF_PROVIDER=package \
               -DgRPC_RE2_PROVIDER=package      \
               -DgRPC_SSL_PROVIDER=package      \
               -DgRPC_ZLIB_PROVIDER=package
   make
   sudo make install
   ```

8. 将 /usr/local/bin 放到环境变量，编辑 `vim ~/.zshrc` 文件最后行

   ```shell
   export PATH=$PATH:/usr/local/bin
   ```

   接着刷新 `source ~/.zshrc`；

9. 为了能正确找到库文件，需要执行下 ldconfig

   ```shell
   sudo ldconfig
   ```

### 初步体验 gRPC

以下编译 cpp 示例 helloworld；

1. 在 gRPC 目录中：

   ```shell
   cd examples/cpp/helloworld/
   
   mkdir build
   cd build
   cmake ..
   make
   ```

2. 终端 1 运行服务器：

   ```shell
   ./greeter_server
   ```

   ![](https://raw.githubusercontent.com/jvfan/jvfan.github.io/master/img/post_img/20210706191140.png)

3. 终端 2 运行客户端：

   ```shell
   ./greeter_client
   ```

   ![](https://raw.githubusercontent.com/jvfan/jvfan.github.io/master/img/post_img/20210706191159.png)

