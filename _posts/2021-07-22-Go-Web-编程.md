---
layout:     post
title:      Go Web 编程
subtitle:   使用 Go 语言创建 Web 应用
date:       2021-07-22
author:     Jerry Chen
header-img: img/post-bg-debug.png
catalog: true
tags:
    - Go
---

> 实践内容参考 [build-web-application-with-golang](https://github.com/astaxie/build-web-application-with-golang)；

### 一些规划

#### GOPATH 目录

$GOPATH 目录下有三个子目录：

* src 存放源代码（如 .go .c .h .s 等）；
* pkg 存放编译后生成的文件（如 .a）；
* bin 存放编译后生成的可执行文件；

#### 代码目录结构

$GOPATH 下的 src 目录是接下来开发程序的主要目录，所有的应用包或可执行应用都会在下面新建一个项目目录，比如 $GOPATH/src/demo；

* 应用包示例：
  * 目录：$GOPATH/src/demo_pack；
  * 文件：$GOPATH/src/demo_pack/xxx.go 中有 `package demo_pack`，一般建议 package 名称和目录名称保持一致；
* 可执行应用示例：
  * 目录：$GOPATH/src/demo_elf；
  * 文件：$GOPATH/src/demo_elf/xxx.go 中有 `package main`；

#### 了解 Go 语言的两种包管理方式

##### [推荐] gomod 方式

使用 go mod 管理项目，就不需要强制把项目放到 $GOPATH/src 目录下，可以在磁盘的任何位置新建应用包（应用包目录中需要有 go.mod 文件指明依赖路径）；

开启方法：

> 给 GO111MODULE 赋值为 off 即使用 gopath 方式；

```shell
go env -w GO111MODULE=on
```

##### gopath 方式

网上有很多教程都是使用的这种方式，所以没有 `go mod init xxx` 的操作，也不需要 go.mod 文件。特点是项目需要强制放在 $GOPATH/src 目录下；

开启方法：

```shell
go env -w GO111MODULE=off
```

### 搭建一个简单工程

> 下面的工程都以 gomod 为包管理方式进行管理；

#### 新建一个应用包 mymath

1. 在 $GOPATH/src 目录下新建目录 mymath；

   ```shell
   cd $GOPATH/src
   mkdir mymath
   ```

2. 在 mymath 中新建文件 sqrt.go，内容如下：

   ```go
   // $GOPATH/src/mymath/sqrt.go 源码
   // 一般模块包建议 package xxx 中 xxx 和目录名称保持一致
   package mymath
   
   func Sqrt(x float64) float64{
       z := 0.0
       for i:= 0; i < 1000; i++ {
           z -= (z * z - x)/(2 * x)
       }
       return z
   }
   ```
   
3. 编译安装应用 mymath，只需在应用包目录执行：

   ```shell
   # 创建 go.mod 文件（模块名默认是当前文件夹名称，可以使用 go mod init xxx 指定其他名称）
   go mod init
   
   # 进行安装
   go install
   ```

   安装完成后就可以在 $GOPATH/pkg/${GOOS}_${GOARCH} 目录找到 mymath.a 文件：

   ![](https://gitee.com/mypic/Images/raw/master/img/20210722235010.png)

#### 新建可执行应用包 mathapp

1. 在 $GOPATH/src 目录下新建目录 mathapp；

   ```shell
   cd $GOPATH/src
   mkdir mathapp
   ```

2. 在 mathapp 中新建文件 main.go，内容如下：

   ```go
   // $GOPATH/src/mathapp/main.go 源码
   package main
   
   import(
   	"mymath"
       "fmt"
   )
   
   func main() {
       fmt.Printf("Hello, world. Sqrt(2)=%v\n", mymath.Sqrt(2))
   }
   ```

3. 编译安装应用 mathapp，只需在应用包目录执行：

   ```shell
   # 创建 go.mod 文件（模块名默认是当前文件夹名称，可以使用 go mod init xxx 指定其他名称）
   go mod init
   # 编辑目标依赖路径
   go mod edit -replace mymath=../mymath
   # 处理依赖（下载依赖项和剔除未用依赖）
   go mod tidy
   
   # 进行安装
   go install
   ```

   安装完成后就可以在 $GOPATH/bin 目录找到 mathapp 可执行文件，运行效果如下：

   ![](https://gitee.com/mypic/Images/raw/master/img/20210723010238.png)

### Go 语言基础

明天接着补充~
