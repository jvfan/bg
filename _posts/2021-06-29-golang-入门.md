---
layout:     post
title:      golang 入门
subtitle:   从零学习 go 语言
date:       2021-06-29
author:     Jerry Chen
header-img: img/post-bg-debug.png
catalog: true
tags:
    - go


---

### go 语言介绍

go 是 Google 开发的一种静态强类型、编译型、并发型，并具有垃圾回收功能的编程语言。具有简单、可靠、高效的特点。

[go 语言官网](https://golang.google.cn/) 

代码示例：

```go
package main

import "fmt"

func main() {
	fmt.Println("Hello, 世界")
}
```

### 安装

#### linux 安装

[下载二进制包](https://golang.google.cn/dl/go1.16.5.linux-amd64.tar.gz) 

1. 解压到 /usr/local 目录

   ```shell
   rm -rf /usr/local/go
   tar -C /usr/local -xzf go1.16.5.linux-amd64.tar.gz
   ```

2. 添加环境变量

   > 可在 ~/.zshrc、~/.bashrc 等文件末尾添加上环境变量然后 `source ~/.zshrc`；

   ```shell
   export PATH=$PATH:/usr/local/go/bin
   ```

#### windows 安装

[下载安装包](https://golang.google.cn/dl/go1.16.5.windows-amd64.msi) 

双击安装，一路 next 即可；

接着打开 Windows 环境变量设置页 --> 用户环境变量

* 安装后有一个环境变量 GOPATH 默认值是 `%USERPROFILE%\go`，修改为你的工作目录，比如 `D:\Projects\GoWork`；
* 在 PATH 中添加一个 `%GOPATH%\bin`，这样可以直接在命令行执行通过 `go get -u xxx.com` 得到的模块 bin 文件；
* 如果 powershell 正在使用，Win10 修改环境变量后完全退出并重新打开 powershell，确保环境变量生效；

### 初步使用

#### 设置 go 模块代理

> go 版本需要在 1.13 及以上；
>
> 使用七牛云 go 模块代理；

```shell
go env -w GO111MODULE=on
go env -w GOPROXY=https://goproxy.cn,direct
```

#### 使用 vscode go 插件

1. 在 vscode 中按如下风格新建一个 hello.go 文件；

   ![](https://raw.githubusercontent.com/jvfan/jvfan.github.io/master/img/post_img/20210630004257.png)

2. 接着 vscode 会提示安装 go 插件；

   ![](https://raw.githubusercontent.com/jvfan/jvfan.github.io/master/img/post_img/20210630004049.png)

3. 插件安装安装完成后右下角会提示安装必要 go 模块，点击安装全部即可（请先设置好 go 代理）；

   > 如果确认已经设置好了 go 代理，但是安装不成功，就重启 vscode 一次；

   安装会自动创建 `~/go` 目录，并把模块放在这个目录；

4. 在 vscode 工作区的 hello 目录下打开控制台，执行初始化模块

   > 执行完成后会在当前目录生成 go.mod 文件；

   ```shell
   go mod init example.com/hello
   ```

5. 编写 hello.go 的内容，并在第二条打印处加个断点；

   ```go
   package main
   
   import "fmt"
   
   func main() {
   	fmt.Println("Hello, World1!")
   	fmt.Println("Hello, World2!")
   	fmt.Println("Hello, World3!")
   }
   ```

6. 解决首行 `package main` 中有波浪号的问题；

   * 新建 `.vscode/settings.json` 文件，填入如下内容：

     ```
     {
         "gopls": {
             "experimentalWorkspaceModule": true
         }
     }
     ```

   * 重启 vscode；

7. 最终目录下文件如下，可按 F5 进行仿真；

   ![](https://raw.githubusercontent.com/jvfan/jvfan.github.io/master/img/post_img/20210630005134.png)

### 简单的模块调用

#### 调用 github 上的 go 模块

1. 创建新文件 hello.go

   ```shell
   mkdir -p ~/vscode/golang/test1
   touch ~/vscode/golang/test1/hello.go
   ```

2. 编辑 hello.go 文件

   > 模块来自 https://github.com/rsc/quote

   ```go
   package main
   
   import "fmt"
   
   import "rsc.io/quote"
   
   func main(){
       fmt.Println(quote.Go())
   }
   ```

3. 初始化模块并补充依赖

   ```shell
   # 初始化模块
   go mod init example.com/hello
   
   # 添加缺少模块以及移除多余模块
   go mod tidy
   ```

4. 文件目录如下：

   > 引用远程模块导致在 vscode 显示波浪号暂时无解；

   ![](https://raw.githubusercontent.com/jvfan/jvfan.github.io/master/img/post_img/20210704005752.png)

5. 直接执行效果如下：

   > 不直接执行，而是编译为当前系统执行文件使用 `go build .`；

   ```shell
   go run .
   ```

   ![](https://raw.githubusercontent.com/jvfan/jvfan.github.io/master/img/post_img/20210704010020.png)

#### 编写一个被调模块和主模块



##### 编写被调模块

1. 创建新文件 greetings.go

   ```shell
   mkdir -p ~/vscode/golang/test2/greetings
   touch ~/vscode/golang/test2/greetings/greetings.go
   ```

2. 编辑 greetings.go 文件

   ```go
   package greetings
   
   import "fmt"
   
   // Hello returns a greeting for the named person.
   func Hello(name string) string {
   	// Return a greeting that embeds the name in a message.
   	message := fmt.Sprintf("Hi, %v. Welcome!", name)
   	return message
   }
   ```

3. 初始化模块

   ```shell
   go mod init example.com/greetings
   ```

4. 文件目录如下：

   ![](https://raw.githubusercontent.com/jvfan/jvfan.github.io/master/img/post_img/20210704011237.png)

##### 编写主模块

1. 创建新文件 hello.go

   ```shell
   mkdir -p ~/vscode/golang/test2/hello
   touch ~/vscode/golang/test2/hello/hello.go
   ```

2. 编辑 hello.go 文件，调用 "example.com/greetings" 模块

   ```go
   package main
   
   import (
       "fmt"
       "example.com/greetings"
   )
   
   func main() {
       // Get a greeting message and print it.
       message := greetings.Hello("Gladys")
       fmt.Println(message)
   }
   ```

3. 初始化模块并补充依赖

   ```shell
   # 初始化模块
   go mod init example.com/hello
   
   # 重定向依赖，greetings 在 ../greetings 目录
   go mod edit -replace example.com/greetings=../greetings
   
   # 添加缺少模块以及移除多余模块
   go mod tidy
   ```

4. 文件目录如下：

   ![](https://raw.githubusercontent.com/jvfan/jvfan.github.io/master/img/post_img/20210704011716.png)

5. 直接执行效果如下：

   > 不直接执行，而是编译为当前系统执行文件使用 `go build .`；

   ```shell
   go run .
   ```

   ![](https://raw.githubusercontent.com/jvfan/jvfan.github.io/master/img/post_img/20210704011746.png)

### 初步尝试 beego

[beego 官网](https://beego.me/) 

#### 安装 beego 和 bee

前提条件：

* go 1.1+
* 开启 GO111MODULE
* 配置好环境变量 GOPATH、PATH（能找到 `$GOPATH/bin`）；

> 以下命令会安装 beego、bee 到 $GOPATH 中；

```shell
go get -u github.com/beego/beego/v2
go get -u github.com/beego/bee/v2
```

#### 快速演示

##### Linux 平台

```shell
cd $GOPATH/src
bee new hello
cd hello
bee run
```

##### Windows 平台

```powershell
cd %GOPATH%/src
bee new hello
cd hello
bee run
```

##### 运行结果

运行过程中出现报错：

```
2021/07/21 15:14:54 ERROR    ▶ 0003 Failed to build the application: go: github.com/beego/beego/v2@v2.0.1: missing go.sum entry; to add it:
        go mod download github.com/beego/beego/v2

2021/07/21 15:15:07 ERROR    ▶ 0003 Failed to build the application: ..\..\pkg\mod\github.com\beego\beego\v2@v2.0.1\server\web\staticfile.go:29:2: missing go.sum entry for module providing package github.com/hashicorp/golang-lru (imported by github.com/beego/beego/v2/server/web); to add:
        go get github.com/beego/beego/v2/server/web@v2.0.1
```

按照提示下载模块即可解决：

```shell
go mod download github.com/beego/beego/v2
go get github.com/beego/beego/v2/server/web@v2.0.1
```

一旦程序开始正常运行，就可以在浏览器中打开 http://localhost:8080/ 进行访问。

![](https://gitee.com/mypic/Images/raw/master/img/20210721153524.png)

